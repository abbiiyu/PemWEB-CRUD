<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRUD Barang</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold text-center mb-8">CRUD Barang</h1>

    <form id="addForm" class="bg-white p-6 rounded shadow-md mb-6" enctype="multipart/form-data">
        <h2 class="text-xl font-semibold mb-4">Tambah Barang</h2>
        <input type="text" id="name" name="name" placeholder="Nama Barang" required class="w-full mb-4 p-2 border rounded">
        <input type="number" id="price" name="price" placeholder="Harga Barang" required class="w-full mb-4 p-2 border rounded">
        <input type="file" id="image" name="image" required class="w-full mb-4 p-2 border rounded">
        <textarea id="description" name="description" placeholder="Deskripsi Barang" required class="w-full mb-4 p-2 border rounded"></textarea>
        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Tambah Barang</button>
    </form>

    <table class="table-auto w-full border-collapse border border-gray-300">
        <thead>
          <tr>
            <th class="border px-4 py-2">ID</th>
            <th class="border px-4 py-2">Nama</th>
            <th class="border px-4 py-2">Harga</th>
            <th class="border px-4 py-2">Gambar</th>
            <th class="border px-4 py-2">Deskripsi</th>
            <th class="border px-4 py-2">Aksi</th>
          </tr>
        </thead>
        <tbody id="itemTable"></tbody>
    </table>

    <div id="editModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center">
      <form id="editForm" class="bg-white p-6 rounded shadow-md" enctype="multipart/form-data">
        <input type="hidden" id="editId" name="id">
        <input type="hidden" id="currentImage" name="currentImage">
        <input type="text" id="editName" name="name" required class="w-full mb-4 p-2 border rounded">
        <input type="number" id="editPrice" name="price" required class="w-full mb-4 p-2 border rounded">
        <input type="file" id="editImage" name="image" class="w-full mb-4 p-2 border rounded">
        <textarea id="editDescription" name="description" required class="w-full mb-4 p-2 border rounded"></textarea>
        <button type="button" onclick="closeEditModal()" class="bg-gray-500 text-white px-4 py-2 rounded">Batal</button>
        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Simpan</button>
      </form>
    </div>
  </div>

  <script>
    async function fetchData() {
      const response = await fetch('crud.php');
      const data = await response.json();
      const table = document.getElementById('itemTable');
      table.innerHTML = '';
      data.forEach(item => {
        table.innerHTML += `
          <tr>
            <td>${item.id}</td>
            <td>${item.name}</td>
            <td>${item.price}</td>
            <td><img src="${item.image}" class="w-16"></td>
            <td>${item.description}</td>
            <td>
              <button onclick="openEditModal(${item.id}, '${item.name}', ${item.price}, '${item.image}', '${item.description}')">Edit</button>
              <button onclick="deleteItem(${item.id})">Hapus</button>
            </td>
          </tr>`;
      });
    }

    async function deleteItem(id) {
      const formData = new FormData();
      formData.append('action', 'delete');
      formData.append('id', id);
      await fetch('crud.php', { method: 'POST', body: formData });
      fetchData();
    }

    function openEditModal(id, name, price, image, description) {
      document.getElementById('editId').value = id;
      document.getElementById('editName').value = name;
      document.getElementById('editPrice').value = price;
      document.getElementById('currentImage').value = image;
      document.getElementById('editDescription').value = description;
      document.getElementById('editModal').classList.remove('hidden');
    }

    function closeEditModal() {
      document.getElementById('editModal').classList.add('hidden');
    }

    document.getElementById('editForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const formData = new FormData(this);
      formData.append('action', 'update');
      await fetch('crud.php', { method: 'POST', body: formData });
      closeEditModal();
      fetchData();
    });

    fetchData();
  </script>
</body>
</html>
